!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t=50,e=50,i=30,s=8,n=10,a=30,o=20,r=8,h=.7,l=.7,d=.7,c=.7,u=.4,g=.7,m=.05,p=.001,y=-1,f=.2,w=.998,v=.05,x=5,b=3,E=100,I=10,k=2.4,M=4,A=.21,T=4,B=10;function S(t){return t[0]&&"number"==typeof t[0].length?t.map(t=>new Float32Array(t.length)):new Float32Array(t.length)}function L(e){const i=document.getElementById("log"),s=document.createElement("div");for(s.className="log-entry",s.textContent=`[${(new Date).toLocaleTimeString()}] ${e}`,i.appendChild(s),i.scrollTop=i.scrollHeight;i.children.length>t;)i.removeChild(i.firstChild)}class C{static show(t,e="info",i=3e3){const s=document.createElement("div");s.className=`toast toast-${e}`,s.textContent=t,s.style.cssText=`\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            background: ${"success"===e?"#4caf50":"error"===e?"#f44336":"#667eea"};\n            color: white;\n            padding: 12px 20px;\n            border-radius: 6px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n            z-index: 10000;\n            font-size: 14px;\n            animation: slideIn 0.3s ease;\n        `,document.body.appendChild(s),setTimeout(()=>{s.style.animation="slideOut 0.3s ease",setTimeout(()=>s.remove(),300)},i)}static success(t){this.show(t,"success")}static error(t){this.show(t,"error")}static info(t){this.show(t,"info")}}if(!document.querySelector("style[data-toast-animations]")){const t=document.createElement("style");t.setAttribute("data-toast-animations","true"),t.textContent="\n        @keyframes slideIn {\n            from { transform: translateX(400px); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n        }\n        @keyframes slideOut {\n            from { transform: translateX(0); opacity: 1; }\n            to { transform: translateX(400px); opacity: 0; }\n        }\n    ",document.head.appendChild(t)}class z{constructor(){this.gravity=9.8,this.massCart=1,this.massPole=.1,this.totalMass=this.massCart+this.massPole,this.length=.5,this.poleMassLength=this.massPole*this.length,this.forceMag=10,this.tau=.02,this.thetaThreshold=12*Math.PI/180,this.xThreshold=2.4,this.reset()}reset(){return this.x=.1*(Math.random()-.5),this.xDot=.1*(Math.random()-.5),this.theta=.1*(Math.random()-.5),this.thetaDot=.1*(Math.random()-.5),this.steps=0,this.getState()}getState(){return[this.x,this.xDot,this.theta,this.thetaDot]}step(t){const e=1===t?this.forceMag:-this.forceMag,i=Math.cos(this.theta),s=Math.sin(this.theta),n=(e+this.poleMassLength*this.thetaDot*this.thetaDot*s)/this.totalMass,a=(this.gravity*s-i*n)/(this.length*(4/3-this.massPole*i*i/this.totalMass)),o=n-this.poleMassLength*a*i/this.totalMass;this.x+=this.tau*this.xDot,this.xDot+=this.tau*o,this.theta+=this.tau*this.thetaDot,this.thetaDot+=this.tau*a,this.steps++;const r=this.x<-this.xThreshold||this.x>this.xThreshold||this.theta<-this.thetaThreshold||this.theta>this.thetaThreshold||this.steps>=500,h=r?0:1;return{state:this.getState(),reward:h,done:r}}}class P{constructor(t,e=.001,i=.9,s=.999,n=1e-8){this.learningRate=e,this.beta1=i,this.beta2=s,this.epsilon=n,this.t=0,this.m=S(t),this.v=S(t)}update(t,e){if(this.t++,t[0]&&"number"==typeof t[0].length)for(let i=0;i<t.length;i++)for(let s=0;s<t[i].length;s++){this.m[i][s]=this.beta1*this.m[i][s]+(1-this.beta1)*e[i][s],this.v[i][s]=this.beta2*this.v[i][s]+(1-this.beta2)*e[i][s]*e[i][s];const n=this.m[i][s]/(1-Math.pow(this.beta1,this.t)),a=this.v[i][s]/(1-Math.pow(this.beta2,this.t));t[i][s]-=this.learningRate*n/(Math.sqrt(a)+this.epsilon)}else for(let i=0;i<t.length;i++){this.m[i]=this.beta1*this.m[i]+(1-this.beta1)*e[i],this.v[i]=this.beta2*this.v[i]+(1-this.beta2)*e[i]*e[i];const s=this.m[i]/(1-Math.pow(this.beta1,this.t)),n=this.v[i]/(1-Math.pow(this.beta2,this.t));t[i]-=this.learningRate*s/(Math.sqrt(n)+this.epsilon)}}}class F{constructor(t,e,i,s="relu"){this.inputSize=t,this.hiddenSizes=Array.isArray(e)?e:[e],this.outputSize=i,this.activation=s,this.layers=[];let n=t;for(const a of this.hiddenSizes)this.layers.push({w:this.heInitialize(n,a),b:new Float32Array(a),type:"hidden"}),n=a;this.actorHead={w:this.heInitialize(n,i),b:new Float32Array(i)},this.criticHead={w:this.heInitialize(n,1),b:new Float32Array(1)},this.optimizers={layers:[],actor:{w:new P(this.actorHead.w),b:new P(this.actorHead.b)},critic:{w:new P(this.criticHead.w),b:new P(this.criticHead.b)}};for(const a of this.layers)this.optimizers.layers.push({w:new P(a.w),b:new P(a.b)});this.lastInput=null,this.lastHidden=[],this.lastOutput=null,this.lastValue=0}heInitialize(t,e){const i=Math.sqrt(6/t),s=[];for(let n=0;n<t;n++){s[n]=new Float32Array(e);for(let t=0;t<e;t++)s[n][t]=2*(Math.random()-.5)*i}return s}activate(t,e=!1){switch(this.activation){case"relu":default:return e?t>0?1:0:Math.max(0,t);case"tanh":if(e){const e=Math.tanh(t);return 1-e*e}return Math.tanh(t);case"elu":const i=1;return e?t>0?1:i*Math.exp(t):t>0?t:i*(Math.exp(t)-1);case"swish":const s=1/(1+Math.exp(-t));return e?s+t*s*(1-s):t*s}}softmax(t){const e=Math.max(...t),i=new Float32Array(t.length);let s=0;for(let a=0;a<t.length;a++)i[a]=Math.exp(t[a]-e),s+=i[a];const n=new Float32Array(t.length);for(let a=0;a<t.length;a++)n[a]=i[a]/s;return n}forward(t){this.lastInput=new Float32Array(t),this.lastHidden=[],this.lastPreActivation=[];let e=t;for(let n=0;n<this.layers.length;n++){const t=this.layers[n],i=new Float32Array(t.b.length),s=new Float32Array(t.b.length);for(let n=0;n<t.b.length;n++){let a=t.b[n];for(let i=0;i<e.length;i++)a+=e[i]*t.w[i][n];s[n]=a,i[n]=this.activate(a)}this.lastPreActivation.push(new Float32Array(s)),this.lastHidden.push(new Float32Array(i)),e=i}const i=new Float32Array(this.outputSize);for(let n=0;n<this.outputSize;n++){let t=this.actorHead.b[n];for(let i=0;i<e.length;i++)t+=e[i]*this.actorHead.w[i][n];i[n]=t}this.lastOutput=this.softmax(i);let s=this.criticHead.b[0];for(let n=0;n<e.length;n++)s+=e[n]*this.criticHead.w[n][0];return this.lastValue=s,{policy:this.lastOutput,value:this.lastValue}}selectAction(t,e=0){const{policy:i}=this.forward(t);if(e>0&&Math.random()<e)return Math.random()<.5?0:1;const s=Math.random();let n=0;for(let a=0;a<i.length;a++)if(n+=i[a],s<n)return a;return i.length-1}getEntropy(){if(!this.lastOutput)return 0;let t=0;for(let e=0;e<this.lastOutput.length;e++){const i=this.lastOutput[e];i>0&&(t-=i*Math.log(i))}return t}getAvgWeight(t){let e=0,i=0;for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)e+=Math.abs(t[s][n]),i++;return i>0?e/i:0}update(t,e,i=.01,s=.5,n=1,a=.95){const o=[],r=[],h=[];let l=0,d=0;for(let M=0;M<t.length;M++){const{value:e}=this.forward(t[M].state);r.push(e)}let c=0;for(let M=t.length-1;M>=0;M--){const i=t[M].reward,s=r[M];c=i+e*(M<t.length-1?r[M+1]:0)-s+e*a*c,h.unshift(c),o.unshift(c+s)}const u=h.reduce((t,e)=>t+e,0)/h.length,g=Math.sqrt(h.reduce((t,e)=>t+(e-u)**2,0)/h.length),m=h.map(t=>(t-u)/(g+1e-8)),p=this.layers.map(t=>({w:t.w.map(t=>new Float32Array(t.length)),b:new Float32Array(t.b.length)})),y={w:this.actorHead.w.map(t=>new Float32Array(t.length)),b:new Float32Array(this.actorHead.b.length)},f={w:this.criticHead.w.map(t=>new Float32Array(t.length)),b:new Float32Array(this.criticHead.b.length)};for(let M=0;M<t.length;M++){const{state:e,action:n}=t[M],a=m[M],r=o[M],{policy:h,value:c}=this.forward(e),u=h[n],g=Math.log(u+1e-10);let w=0;for(const t of h)t>0&&(w-=t*Math.log(t));l+=-g*a-i*w;d+=s*(c-r)**2;const v=new Float32Array(h);v[n]-=1;for(let t=0;t<this.outputSize;t++)v[t]*=a,v[t]+=i*h[t]*(Math.log(h[t]+1e-10)+w);const x=new Float32Array(1);x[0]=2*s*(c-r),this.backprop(e,v,x,p,y,f)}const w=this.getGradientNorm([...p,y,f]),v=Math.min(1,n/(w+1e-10));v<1&&this.scaleGradients([...p,y,f],v);const x=t.length;for(let M=0;M<this.layers.length;M++){const t=p[M].w.map(t=>{const e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/x;return e}),e=new Float32Array(p[M].b.length);for(let i=0;i<p[M].b.length;i++)e[i]=p[M].b[i]/x;this.optimizers.layers[M].w.update(this.layers[M].w,t),this.optimizers.layers[M].b.update(this.layers[M].b,e)}const b=y.w.map(t=>{const e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/x;return e}),E=new Float32Array(y.b.length);for(let M=0;M<y.b.length;M++)E[M]=y.b[M]/x;this.optimizers.actor.w.update(this.actorHead.w,b),this.optimizers.actor.b.update(this.actorHead.b,E);const I=f.w.map(t=>{const e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/x;return e}),k=new Float32Array(f.b.length);for(let M=0;M<f.b.length;M++)k[M]=f.b[M]/x;return this.optimizers.critic.w.update(this.criticHead.w,I),this.optimizers.critic.b.update(this.criticHead.b,k),{avgAdvantage:h.reduce((t,e)=>t+e,0)/h.length,avgReturn:o.reduce((t,e)=>t+e,0)/o.length,gradNorm:w,actorLoss:l/x,criticLoss:d/x}}getGradientNorm(t){let e=0;for(const i of t){for(let t=0;t<i.w.length;t++)for(let s=0;s<i.w[t].length;s++)e+=i.w[t][s]*i.w[t][s];for(let t=0;t<i.b.length;t++)e+=i.b[t]*i.b[t]}return Math.sqrt(e)}scaleGradients(t,e){for(const i of t){for(let t=0;t<i.w.length;t++)for(let s=0;s<i.w[t].length;s++)i.w[t][s]*=e;for(let t=0;t<i.b.length;t++)i.b[t]*=e}}backprop(t,e,i,s,n,a){const o=this.lastHidden[this.lastHidden.length-1];for(let h=0;h<o.length;h++)for(let t=0;t<this.outputSize;t++)n.w[h][t]+=o[h]*e[t];for(let h=0;h<this.outputSize;h++)n.b[h]+=e[h];for(let h=0;h<o.length;h++)a.w[h][0]+=o[h]*i[0];a.b[0]+=i[0];let r=new Float32Array(o.length);for(let h=0;h<o.length;h++){for(let t=0;t<this.outputSize;t++)r[h]+=e[t]*this.actorHead.w[h][t];r[h]+=i[0]*this.criticHead.w[h][0]}for(let h=this.layers.length-1;h>=0;h--){const t=this.layers[h],e=this.lastHidden[h],i=this.lastPreActivation[h],n=h>0?this.lastHidden[h-1]:this.lastInput;for(let s=0;s<r.length;s++)r[s]*=this.activate(i[s],!0);for(let a=0;a<n.length;a++)for(let t=0;t<e.length;t++)s[h].w[a][t]+=n[a]*r[t];for(let a=0;a<e.length;a++)s[h].b[a]+=r[a];if(h>0){const i=new Float32Array(n.length);for(let s=0;s<n.length;s++)for(let n=0;n<e.length;n++)i[s]+=r[n]*t.w[s][n];r=i}}}get w1(){var t;return(null==(t=this.layers[0])?void 0:t.w)||[]}get w2(){return this.layers.length>1?this.layers[1].w:this.actorHead.w}get hiddenSize(){return this.hiddenSizes[0]}setLearningRate(t){for(const e of this.optimizers.layers)e.w.learningRate=t,e.b.learningRate=t;this.optimizers.actor.w.learningRate=t,this.optimizers.actor.b.learningRate=t,this.optimizers.critic.w.learningRate=t,this.optimizers.critic.b.learningRate=t}getInputImportance(t){const{policy:e,value:i}=this.forward(t),s=new Float32Array(t.length);if(this.layers[0]){const e=this.layers[0].w;for(let i=0;i<t.length;i++){let n=0;for(let t=0;t<e[i].length;t++)n+=Math.abs(e[i][t]);s[i]=Math.abs(t[i])*n}}return s}}class H{constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.offscreenCtx=this.offscreenCanvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height,this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height}render(t){const m=this.offscreenCtx,p=this.offscreenCanvas.width,y=this.offscreenCanvas.height;m.fillStyle="rgba(227, 242, 253, 0.5)",m.fillRect(0,0,p,y),m.fillStyle="#8d6e63",m.fillRect(0,y*h,p,y*(1-h)),m.strokeStyle="#555",m.lineWidth=2,m.beginPath(),m.moveTo(0,y*l),m.lineTo(p,y*l),m.stroke();const f=p/6,w=p/2-t.xThreshold*f,v=p/2+t.xThreshold*f;m.strokeStyle="#f44336",m.lineWidth=3,m.setLineDash([5,5]),m.beginPath(),m.moveTo(w,.5*y),m.lineTo(w,y*d),m.stroke(),m.beginPath(),m.moveTo(v,.5*y),m.lineTo(v,y*d),m.stroke(),m.setLineDash([]);const x=p/2+t.x*f,b=y*d,E=e,I=i;m.fillStyle="#1976d2",m.fillRect(x-E/2,b-I,E,I),m.fillStyle="#333",m.beginPath(),m.arc(x-E/3,b,s,0,2*Math.PI),m.fill(),m.beginPath(),m.arc(x+E/3,b,s,0,2*Math.PI),m.fill();const k=2*t.length*f,M=x+k*Math.sin(t.theta),A=b-I-k*Math.cos(t.theta),T=Math.abs(t.theta)/t.thetaThreshold;let B="#4caf50";if(T>c?B="#f44336":T>u&&(B="#ff9800"),m.strokeStyle=B,m.lineWidth=6,m.lineCap="round",m.beginPath(),m.moveTo(x,b-I),m.lineTo(M,A),m.stroke(),m.fillStyle=B,m.beginPath(),m.arc(M,A,n,0,2*Math.PI),m.fill(),m.strokeStyle=B,m.lineWidth=2,m.globalAlpha=.5,m.beginPath(),m.arc(x,b-I,a,-Math.PI/2,-Math.PI/2+t.theta,t.theta>0),m.stroke(),m.globalAlpha=1,Math.abs(t.xDot)>.1){m.strokeStyle="#2196f3",m.lineWidth=4,m.beginPath(),m.moveTo(x,b-I/2);const e=o;m.lineTo(x+t.xDot*e,b-I/2),m.stroke();const i=t.xDot>0?0:Math.PI;m.beginPath(),m.moveTo(x+t.xDot*e,b-I/2),m.lineTo(x+t.xDot*e-Math.cos(i-Math.PI/6)*r,b-I/2-Math.sin(i-Math.PI/6)*r),m.lineTo(x+t.xDot*e-Math.cos(i+Math.PI/6)*r,b-I/2-Math.sin(i+Math.PI/6)*r),m.closePath(),m.fillStyle="#2196f3",m.fill()}m.fillStyle="#333",m.font="bold 14px monospace",m.fillText(`Î¸: ${(180*t.theta/Math.PI).toFixed(1)}Â°`,10,20),m.fillText(`x: ${t.x.toFixed(2)}`,10,40),(Math.abs(t.x)>t.xThreshold*g||Math.abs(t.theta)>t.thetaThreshold*g)&&(m.fillStyle="#f44336",m.font="bold 16px sans-serif",m.fillText("âš ï¸ CRITICAL",p-120,30)),this.ctx.drawImage(this.offscreenCanvas,0,0)}}class D{constructor(t){this.svg=document.getElementById(t),this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.svg.getBoundingClientRect();this.width=t.width,this.height=t.height}visualize(t){this.svg.innerHTML="";const e=[{size:t.inputSize,label:"Input",type:"input"}];for(let a=0;a<t.hiddenSizes.length;a++)e.push({size:t.hiddenSizes[a],label:`Hidden ${a+1}`,type:"hidden",layerIdx:a});e.push({size:t.outputSize,label:"Actor",type:"actor"}),e.push({size:1,label:"Critic",type:"critic"});const i=this.width/(e.length+1),s=e.map((t,s)=>{const n=i*(s+1),a=Math.max(...e.map(t=>t.size)),o=Math.min(25,this.height/(a+1)),r=(this.height-(t.size-1)*o)/2;return Array.from({length:t.size},(t,e)=>({x:n,y:r+e*o}))}),n=document.createElementNS("http://www.w3.org/2000/svg","g");for(let a=0;a<e.length-1;a++){const i=e[a],o=e[a+1];let r=null;if("input"===i.type&&"hidden"===o.type?r=t.layers[0].w:"hidden"===i.type&&"hidden"===o.type?r=t.layers[o.layerIdx].w:"hidden"===i.type&&"actor"===o.type?r=t.actorHead.w:"hidden"===i.type&&"critic"===o.type&&(r=t.criticHead.w),r)for(let t=0;t<i.size;t++)for(let e=0;e<o.size;e++){const i=r[t][e],h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("x1",s[a][t].x),h.setAttribute("y1",s[a][t].y),h.setAttribute("x2",s[a+1][e].x),h.setAttribute("y2",s[a+1][e].y);const l=Math.min(1,2*Math.abs(i));let d=i>0?"#4caf50":"#f44336";"critic"===o.type&&(d=i>0?"#2196f3":"#ff9800"),h.setAttribute("stroke",d),h.setAttribute("stroke-opacity",.3*l),h.setAttribute("stroke-width","1"),n.appendChild(h)}}this.svg.appendChild(n),e.forEach((e,n)=>{s[n].forEach((i,s)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx",i.x),n.setAttribute("cy",i.y),n.setAttribute("r",7);let a=0;"input"===e.type&&t.lastInput?a=t.lastInput[s]:"hidden"===e.type&&t.lastHidden[e.layerIdx]?a=t.lastHidden[e.layerIdx][s]:"actor"===e.type&&t.lastOutput?a=t.lastOutput[s]:"critic"===e.type&&(a=t.lastValue/100);const o=Math.min(1,Math.abs(a));let r="#667eea";"critic"===e.type?r="#2196f3":"actor"===e.type&&(r="#4caf50"),n.setAttribute("fill",r),n.setAttribute("fill-opacity",.3+.7*o),n.setAttribute("stroke","#333"),n.setAttribute("stroke-width","2"),this.svg.appendChild(n)});const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",i*(n+1)),a.setAttribute("y",this.height-10),a.setAttribute("text-anchor","middle"),a.setAttribute("font-size","11"),a.setAttribute("font-weight","bold"),"actor"===e.type?a.setAttribute("fill","#4caf50"):"critic"===e.type?a.setAttribute("fill","#2196f3"):a.setAttribute("fill","#666"),a.textContent=e.label,this.svg.appendChild(a)})}}class N{constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.data=[],this.maxDataPoints=100,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}addDataPoint(t,e){this.data.push({episode:t,reward:e}),this.data.length>this.maxDataPoints&&this.data.shift(),this.render()}clear(){this.data=[],this.render()}render(){const t=this.ctx,e=this.canvas.width,i=this.canvas.height,s=40;if(t.fillStyle="white",t.fillRect(0,0,e,i),0===this.data.length)return t.fillStyle="#999",t.font="14px sans-serif",t.textAlign="center",void t.fillText("Training data will appear here...",e/2,i/2);const n=this.data.map(t=>t.reward),a=Math.min(...n),o=Math.max(...n),r=o-a||1;t.strokeStyle="#e0e0e0",t.lineWidth=1;for(let h=0;h<=5;h++){const n=s+(i-80)*h/5;t.beginPath(),t.moveTo(s,n),t.lineTo(e-s,n),t.stroke();const a=o-r*h/5;t.fillStyle="#666",t.font="11px sans-serif",t.textAlign="right",t.fillText(a.toFixed(0),35,n+4)}if(t.strokeStyle="#667eea",t.lineWidth=2,t.beginPath(),this.data.forEach((n,o)=>{const h=s+(e-80)*o/(this.data.length-1||1),l=s+(i-80)*(1-(n.reward-a)/r);0===o?t.moveTo(h,l):t.lineTo(h,l)}),t.stroke(),t.fillStyle="#667eea",this.data.forEach((n,o)=>{const h=s+(e-80)*o/(this.data.length-1||1),l=s+(i-80)*(1-(n.reward-a)/r);t.beginPath(),t.arc(h,l,3,0,2*Math.PI),t.fill()}),this.data.length>=10){t.strokeStyle="#ff9800",t.lineWidth=2,t.setLineDash([5,5]),t.beginPath();for(let n=9;n<this.data.length;n++){const o=this.data.slice(n-9,n+1).reduce((t,e)=>t+e.reward,0)/10,h=s+(e-80)*n/(this.data.length-1),l=s+(i-80)*(1-(o-a)/r);9===n?t.moveTo(h,l):t.lineTo(h,l)}t.stroke(),t.setLineDash([])}t.fillStyle="#333",t.font="12px sans-serif",t.textAlign="center",t.fillText("Episode",e/2,i-5),t.save(),t.translate(15,i/2),t.rotate(-Math.PI/2),t.fillText("Survival Time",0,0),t.restore(),t.textAlign="left",t.fillStyle="#667eea",t.fillRect(e-150,10,15,3),t.fillStyle="#666",t.fillText("Episode Reward",e-130,15),t.fillStyle="#ff9800",t.fillRect(e-150,25,15,3),t.fillStyle="#666",t.fillText("10-Ep Average",e-130,30)}}class R{constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.actorLosses=[],this.criticLosses=[],this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}addDataPoint(t,e){this.actorLosses.push(t),this.criticLosses.push(e),this.actorLosses.length>200&&(this.actorLosses.shift(),this.criticLosses.shift()),this.draw()}draw(){const t=this.ctx,e=this.canvas.width,i=this.canvas.height,s=40;if(t.fillStyle="white",t.fillRect(0,0,e,i),0===this.actorLosses.length)return;const n=Math.max(...this.actorLosses,.1),a=Math.max(...this.criticLosses,.1),o=Math.max(n,a);t.strokeStyle="#999",t.lineWidth=1,t.beginPath(),t.moveTo(s,i-s),t.lineTo(e-s,i-s),t.stroke(),t.beginPath(),t.moveTo(s,s),t.lineTo(s,i-s),t.stroke(),t.strokeStyle="#667eea",t.lineWidth=2,t.beginPath();for(let r=0;r<this.actorLosses.length;r++){const n=s+r/(this.actorLosses.length-1||1)*(e-80),a=i-s-this.actorLosses[r]/o*(i-80);0===r?t.moveTo(n,a):t.lineTo(n,a)}t.stroke(),t.strokeStyle="#ff9800",t.lineWidth=2,t.beginPath();for(let r=0;r<this.criticLosses.length;r++){const n=s+r/(this.criticLosses.length-1||1)*(e-80),a=i-s-this.criticLosses[r]/o*(i-80);0===r?t.moveTo(n,a):t.lineTo(n,a)}t.stroke(),t.fillStyle="#333",t.font="12px sans-serif",t.fillText("0",20,i-s+5),t.fillText(o.toFixed(2),5,45),t.fillStyle="#667eea",t.fillRect(e-180,10,12,12),t.fillStyle="#333",t.fillText("Actor Loss",e-160,20),t.fillStyle="#ff9800",t.fillRect(e-180,30,12,12),t.fillStyle="#333",t.fillText("Critic Loss",e-160,40)}clear(){this.actorLosses=[],this.criticLosses=[],this.draw()}}class ${constructor(t){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.heatmapData=null,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width,this.canvas.height=t.height}computeHeatmap(t,e){this.heatmapData=[];const i=-e.xThreshold,s=e.xThreshold,n=-e.thetaThreshold,a=e.thetaThreshold;for(let o=0;o<30;o++){this.heatmapData[o]=[];for(let e=0;e<30;e++){const r=[i+o/30*(s-i),0,n+e/30*(a-n),0],h=[r[0]/k,r[1]/M,r[2]/A,r[3]/T],{value:l}=t.forward(h);this.heatmapData[o][e]=Math.max(0,Math.min(1,(l+50)/100))}}this.draw()}draw(){if(!this.heatmapData){const t=this.ctx;return t.fillStyle="#ccc",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#999",t.font="14px sans-serif",t.textAlign="center",void t.fillText("Train network to see state space values",this.canvas.width/2,this.canvas.height/2)}const t=this.ctx,e=this.canvas.width,i=this.canvas.height,s=this.heatmapData.length,n=e/s,a=i/s;for(let o=0;o<s;o++)for(let e=0;e<s;e++){const i=this.heatmapData[o][e];let s;if(i<.5){s=`rgb(0, ${Math.floor(2*i*255)}, 255)`}else{s=`rgb(${255}, ${255}, ${Math.floor(2*(1-i)*255)})`}t.fillStyle=s,t.fillRect(o*n,e*a,n,a)}t.fillStyle="#333",t.font="11px sans-serif",t.fillText("Position",e/2,i+15),t.save(),t.translate(-15,i/2),t.rotate(-Math.PI/2),t.textAlign="center",t.fillText("Angle",0,0),t.restore()}clear(){this.heatmapData=null,this.draw()}}class O{constructor(){this.metrics={gradNorm:0,avgAdvantage:0,avgReturn:0,avgQValue:0,entropy:0,leftAction:0,rightAction:0}}update(t){Object.assign(this.metrics,t)}render(){document.getElementById("metric-grad-norm")&&(document.getElementById("metric-grad-norm").textContent=this.metrics.gradNorm.toFixed(3)),document.getElementById("metric-advantage")&&(document.getElementById("metric-advantage").textContent=this.metrics.avgAdvantage.toFixed(3)),document.getElementById("metric-return")&&(document.getElementById("metric-return").textContent=this.metrics.avgReturn.toFixed(1)),document.getElementById("metric-qvalue")&&(document.getElementById("metric-qvalue").textContent=this.metrics.avgQValue.toFixed(2)),document.getElementById("metric-entropy")&&(document.getElementById("metric-entropy").textContent=this.metrics.entropy.toFixed(3)),document.getElementById("metric-left-action")&&(document.getElementById("metric-left-action").textContent=(100*this.metrics.leftAction).toFixed(0)+"%"),document.getElementById("metric-right-action")&&(document.getElementById("metric-right-action").textContent=(100*this.metrics.rightAction).toFixed(0)+"%")}}class G{constructor(t=1e4){this.maxSize=t,this.buffer=[],this.priorities=[]}add(t,e=1){this.buffer.push(t),this.priorities.push(Math.abs(e)+.01),this.buffer.length>this.maxSize&&(this.buffer.shift(),this.priorities.shift())}sampleBatch(t){if(0===this.buffer.length)return[];const e=[],i=this.priorities.reduce((t,e)=>t+e,0);for(let s=0;s<Math.min(t,this.buffer.length);s++){let t=Math.random()*i;for(let i=0;i<this.buffer.length;i++)if(t-=this.priorities[i],t<=0){e.push(this.buffer[i]);break}}return e}updatePriorities(t,e){for(let i=0;i<Math.min(t.length,this.buffer.length);i++)this.priorities[this.buffer.length-1-i]=Math.abs(e[i])+.01}clear(){this.buffer=[],this.priorities=[]}size(){return this.buffer.length}}const j=new class{constructor(){this.env=new z,this.network=null,this.renderer=new H("cartpole-canvas"),this.visualizer=new D("network-svg"),this.chart=new N("training-chart"),this.lossChart=new R("training-loss-chart"),this.metricsDashboard=new O,this.replayBuffer=new G,this.heatmap=new $("state-space-heatmap"),this.useReplayBuffer=!1,this.isTraining=!1,this.isTesting=!1,this.isManual=!1,this.isPaused=!1,this.episode=0,this.survivalHistory=[],this.currentTrajectory=[],this.manualAction=null,this.trainingSpeed=x,this.exploration=f,this.explorationDecay=w,this.minExploration=v,this.frameCounter=0,this.lastGradNorm=0,this.lastAvgAdvantage=0,this.lastAvgReturn=0,this.lastActorLoss=0,this.lastCriticLoss=0,this.initNetwork(),this.setupControls(),this.setupKeyboard(),this.setupGlobalKeyboardShortcuts(),this.updateMetrics(),this.updateActionBars(),this.updateStateDisplay(),this.updateNetworkStats(),this.animate(),L("CartPole RL Sandbox initialized"),L("Using Actor-Critic with GAE (Î»=0.95) and Adam optimizer"),L("Network sees 4 inputs: position, velocity, angle, angular velocity"),L("Pole angle & angular velocity are MOST IMPORTANT for balancing!"),L("Watch Input Importance bars to see what the network focuses on"),L("Better exploration: Îµ starts at 0.20, decays slowly to 0.05"),L("Gradient norm and advantage metrics show training health")}normalizeState(t){return[t[0]/k,t[1]/M,t[2]/A,t[3]/T]}initNetwork(){const t=parseInt(document.getElementById("hidden-size").value),e=parseInt(document.getElementById("network-depth").value),i=document.getElementById("activation").value,s=Array(e).fill(t);this.network=new F(4,s,2,i),this.visualizer.visualize(this.network),L(`Network created: 4 â†’ ${s.join(" â†’ ")} â†’ 2 (Actor) + 1 (Critic)`),L(`Activation: ${i.toUpperCase()}, Optimizer: Adam`)}setupControls(){document.getElementById("train-btn").addEventListener("click",()=>this.toggleTraining()),document.getElementById("pause-btn").addEventListener("click",()=>this.togglePause()),document.getElementById("test-btn").addEventListener("click",()=>this.testPolicy()),document.getElementById("reset-btn").addEventListener("click",()=>this.resetPolicy()),document.getElementById("manual-btn").addEventListener("click",()=>this.toggleManual()),document.getElementById("save-network-btn").addEventListener("click",()=>this.saveNetwork()),document.getElementById("load-network-btn").addEventListener("click",()=>this.loadNetwork()),document.getElementById("export-data-btn").addEventListener("click",()=>this.exportTrainingData()),document.getElementById("preset-quick").addEventListener("click",()=>this.applyPreset("quick")),document.getElementById("preset-deep").addEventListener("click",()=>this.applyPreset("deep")),document.getElementById("preset-exploration").addEventListener("click",()=>this.applyPreset("exploration")),document.getElementById("preset-production").addEventListener("click",()=>this.applyPreset("production")),document.getElementById("hidden-size").addEventListener("change",()=>{this.isTraining||this.isManual||this.initNetwork()}),document.getElementById("network-depth").addEventListener("change",()=>{this.isTraining||this.isManual||this.initNetwork()}),document.getElementById("activation").addEventListener("change",()=>{this.isTraining||this.isManual||this.initNetwork()}),document.getElementById("learning-rate").addEventListener("change",t=>{const e=parseFloat(t.target.value);this.network.setLearningRate(e),L(`Learning rate updated to ${e}`)});document.getElementById("training-speed").addEventListener("input",t=>{this.trainingSpeed=parseInt(t.target.value),document.getElementById("speed-value").textContent=`${this.trainingSpeed}x`})}setupKeyboard(){document.addEventListener("keydown",t=>{this.isManual&&("ArrowLeft"===t.key||"a"===t.key||"A"===t.key?(this.manualAction=0,t.preventDefault()):"ArrowRight"!==t.key&&"d"!==t.key&&"D"!==t.key||(this.manualAction=1,t.preventDefault()))})}setMode(t){const e=document.getElementById("mode-indicator");e.textContent=t,e.className="mode-indicator "+({IDLE:"",TRAINING:"mode-training",TESTING:"mode-testing",MANUAL:"mode-manual"}[t]||"")}toggleManual(){if(this.isTraining||this.isTesting)return;this.isManual=!this.isManual;const t=document.getElementById("manual-btn"),e=document.getElementById("keyboard-hint");this.isManual?(t.textContent="Stop Manual",t.className="secondary",e.style.display="block",this.setMode("MANUAL"),this.env.reset(),L("Manual control enabled - use arrow keys or A/D"),this.manualLoop()):(t.textContent="Manual Control",t.className="secondary",e.style.display="none",this.setMode("IDLE"),L("Manual control disabled"))}async manualLoop(){for(;this.isManual;){if(null!==this.manualAction){const t=this.env.step(this.manualAction),e=this.env.getState();this.network.forward(this.normalizeState(e)),t.done&&(L(`Episode ended: survived ${this.env.steps} steps`),await new Promise(t=>setTimeout(t,1e3)),this.env.reset()),this.manualAction=null}this.updateMetrics(),this.updateActionBars(),this.updateStateDisplay(),this.visualizer.visualize(this.network),await new Promise(t=>setTimeout(t,20))}}toggleTraining(){this.isManual&&this.toggleManual(),this.isTraining=!this.isTraining;const t=document.getElementById("train-btn"),e=document.getElementById("pause-btn");this.isTraining?(t.textContent="Stop Training",t.className="danger",e.style.display="block",e.textContent="Pause",this.isPaused=!1,this.setMode("TRAINING"),L("Training started"),this.trainingLoop()):(t.textContent="Start Training",t.className="primary",e.style.display="none",this.isPaused=!1,this.setMode("IDLE"),L("Training stopped"))}togglePause(){this.isPaused=!this.isPaused;const t=document.getElementById("pause-btn");this.isPaused?(t.textContent="Resume",L("Training paused - inspect metrics without losing progress")):(t.textContent="Pause",L("Training resumed"))}async trainingLoop(){for(;this.isTraining;){if(this.isPaused){await new Promise(t=>setTimeout(t,100));continue}await this.runEpisode(!0);const t=Math.max(1,50-5*this.trainingSpeed);await new Promise(e=>setTimeout(e,t))}}async runEpisode(t=!1){const e=this.env.reset();this.currentTrajectory=[];let i=!1;const s=t?Math.max(0,3-.3*this.trainingSpeed):20;for(;!i&&(this.isTraining||this.isTesting);){const n=this.normalizeState(e),a=t?this.network.selectAction(n,this.exploration):this.network.selectAction(n,0),o=this.env.step(a);let r=o.reward;o.done?r=y:(r=1,r-=m*Math.abs(this.env.theta),r-=p*Math.abs(this.env.x)),this.currentTrajectory.push({state:[...n],action:a,reward:r}),Object.assign(e,o.state),i=o.done,this.updateMetrics(),this.updateActionBars(),this.updateStateDisplay(),this.frameCounter++%b===0&&this.visualizer.visualize(this.network),await new Promise(t=>setTimeout(t,s))}if(t&&this.currentTrajectory.length>0){const t=parseFloat(document.getElementById("discount").value),e=parseFloat(document.getElementById("entropy-coef").value),i=this.network.update(this.currentTrajectory,t,e);if(this.lastGradNorm=i.gradNorm,this.lastAvgAdvantage=i.avgAdvantage,this.lastAvgReturn=i.avgReturn,this.lastActorLoss=i.actorLoss,this.lastCriticLoss=i.criticLoss,this.lossChart.addDataPoint(i.actorLoss,i.criticLoss),this.metricsDashboard.update({gradNorm:i.gradNorm,avgAdvantage:i.avgAdvantage,avgReturn:i.avgReturn}),this.metricsDashboard.render(),this.episode%25==0)try{this.heatmap.computeHeatmap(this.network,this.env)}catch(n){}this.exploration=Math.max(this.minExploration,this.exploration*this.explorationDecay)}if(this.episode++,this.survivalHistory.push(this.env.steps),this.survivalHistory.length>E&&this.survivalHistory.shift(),this.chart.addDataPoint(this.episode,this.env.steps),this.episode%I===0){const t=this.survivalHistory.slice(-10).reduce((t,e)=>t+e,0)/Math.min(B,this.survivalHistory.length),e=this.lastGradNorm?` |âˆ‡|=${this.lastGradNorm.toFixed(2)}`:"";L(`Ep ${this.episode}: Avg=${t.toFixed(1)} steps, Îµ=${this.exploration.toFixed(3)}${e}`)}this.updateNetworkStats()}async testPolicy(){this.isTraining&&this.toggleTraining(),this.isManual&&this.toggleManual(),this.isTesting=!0,this.setMode("TESTING");const t=document.getElementById("test-btn");t.disabled=!0,L("Testing current policy..."),await this.runEpisode(!1),L(`Test complete: survived ${this.env.steps} steps`),this.isTesting=!1,this.setMode("IDLE"),t.disabled=!1,this.updateStateDisplay()}resetPolicy(){this.isTraining=!1,this.isTesting=!1,this.isManual&&this.toggleManual(),document.getElementById("train-btn").textContent="Start Training",document.getElementById("train-btn").className="primary",this.setMode("IDLE"),this.episode=0,this.survivalHistory=[],this.exploration=f,this.chart.clear(),this.lossChart.clear(),this.heatmap.clear(),this.replayBuffer.clear(),this.initNetwork(),this.env.reset(),this.updateMetrics(),this.updateStateDisplay(),this.updateNetworkStats(),L("Policy reset - exploration reset to 0.2 with GAE enabled")}updateActionBars(){if(this.network.lastOutput){const t=this.network.lastOutput,e=(100*t[0]).toFixed(1);document.getElementById("action-left").style.transform=`scaleY(${t[0]})`,document.getElementById("action-left-val").textContent=e+"%";const i=(100*t[1]).toFixed(1);document.getElementById("action-right").style.transform=`scaleY(${t[1]})`,document.getElementById("action-right-val").textContent=i+"%"}}updateStateDisplay(){const t=this.env.getState(),[e,i,s,n]=t,a=k,o=M,r=A,h=T,l=Math.min(1,Math.abs(e)/a);document.getElementById("perception-x-val").textContent=e.toFixed(2),document.getElementById("perception-x-bar").style.width=100*l+"%",document.getElementById("perception-x").classList.toggle("active",l>.6);const d=Math.min(1,Math.abs(i)/o);document.getElementById("perception-xdot-val").textContent=i.toFixed(2),document.getElementById("perception-xdot-bar").style.width=100*d+"%",document.getElementById("perception-xdot").classList.toggle("active",d>.4);const c=180*s/Math.PI,u=Math.min(1,Math.abs(s)/r);document.getElementById("perception-theta-val").textContent=c.toFixed(1)+"Â°",document.getElementById("perception-theta-bar").style.width=100*u+"%",document.getElementById("perception-theta").classList.add("active");const g=Math.min(1,Math.abs(n)/h);document.getElementById("perception-thetadot-val").textContent=n.toFixed(2),document.getElementById("perception-thetadot-bar").style.width=100*g+"%",document.getElementById("perception-thetadot").classList.add("active");const m=50+s/r*50;document.getElementById("theta-bar").style.width=Math.max(0,Math.min(100,m))+"%",document.getElementById("theta-value").textContent=c.toFixed(1)+"Â°";const p=50+n/h*50;document.getElementById("thetadot-bar").style.width=Math.max(0,Math.min(100,p))+"%",document.getElementById("thetadot-value").textContent=n.toFixed(2);const y=this.network.getInputImportance(this.normalizeState(t)),f=Math.max(...y,.001),w=y[0]/f*100,v=y[1]/f*100,x=y[2]/f*100,b=y[3]/f*100;document.getElementById("importance-x-bar").style.width=w+"%",document.getElementById("importance-x-val").textContent=w.toFixed(0)+"%",document.getElementById("importance-xdot-bar").style.width=v+"%",document.getElementById("importance-xdot-val").textContent=v.toFixed(0)+"%",document.getElementById("importance-theta-bar").style.width=x+"%",document.getElementById("importance-theta-val").textContent=x.toFixed(0)+"%",document.getElementById("importance-thetadot-bar").style.width=b+"%",document.getElementById("importance-thetadot-val").textContent=b.toFixed(0)+"%"}updateNetworkStats(){let t=0,e=0;for(const a of this.network.layers)for(let i=0;i<a.w.length;i++)for(let s=0;s<a.w[i].length;s++)t+=Math.abs(a.w[i][s]),e++;const i=e>0?t/e:0,s=this.network.getAvgWeight(this.network.actorHead.w),n=this.network.getEntropy();document.getElementById("avg-w1").textContent=i.toFixed(3),document.getElementById("avg-w2").textContent=s.toFixed(3),document.getElementById("entropy").textContent=n.toFixed(3),document.getElementById("exploration-rate").textContent=this.exploration.toFixed(3),document.getElementById("grad-norm").textContent=this.lastGradNorm?this.lastGradNorm.toFixed(2):"0.00",document.getElementById("avg-advantage").textContent=this.lastAvgAdvantage?this.lastAvgAdvantage.toFixed(2):"0.00"}updateMetrics(){if(document.getElementById("episode-count").textContent=this.episode,document.getElementById("steps-count").textContent=this.env.steps,document.getElementById("reward-count").textContent=this.env.steps,void 0!==this.network.lastValue&&(document.getElementById("value-estimate").textContent=this.network.lastValue.toFixed(1)),this.survivalHistory.length>0){const t=this.survivalHistory[this.survivalHistory.length-1],e=Math.max(...this.survivalHistory),i=this.survivalHistory.slice(-10).reduce((t,e)=>t+e,0)/Math.min(10,this.survivalHistory.length);document.getElementById("last-survival").textContent=t,document.getElementById("best-survival").textContent=e,document.getElementById("avg-survival").textContent=i.toFixed(1)}else document.getElementById("last-survival").textContent="0",document.getElementById("best-survival").textContent="0",document.getElementById("avg-survival").textContent="0"}saveNetwork(){const t={timestamp:(new Date).toISOString(),episode:this.episode,survivalHistory:this.survivalHistory,network:{layers:this.network.layers.map(t=>({w:t.w,b:t.b})),actorHead:{w:this.network.actorHead.w,b:this.network.actorHead.b},criticHead:{w:this.network.criticHead.w,b:this.network.criticHead.b},hiddenSizes:this.network.hiddenSizes,activation:this.network.activation},hyperparameters:{learningRate:parseFloat(document.getElementById("learning-rate").value),discount:parseFloat(document.getElementById("discount").value),entropy:parseFloat(document.getElementById("entropy-coef").value),hiddenSize:parseInt(document.getElementById("hidden-size").value),networkDepth:parseInt(document.getElementById("network-depth").value)}},e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(i),n=document.createElement("a");n.href=s,n.download=`cartpole-network-${t.timestamp.substring(0,10)}.json`,n.click(),URL.revokeObjectURL(s),C.success(`Network saved! Trained for ${this.episode} episodes`),L(`Saved network with ${this.episode} episodes of training`)}loadNetwork(){const t=document.createElement("input");t.type="file",t.accept="application/json",t.onchange=t=>{const e=t.target.files[0];if(!e)return;const i=new FileReader;i.onload=t=>{try{const e=JSON.parse(t.target.result);if(e.hyperparameters&&(document.getElementById("learning-rate").value=e.hyperparameters.learningRate,document.getElementById("discount").value=e.hyperparameters.discount,document.getElementById("entropy-coef").value=e.hyperparameters.entropy,document.getElementById("hidden-size").value=e.hyperparameters.hiddenSize,document.getElementById("network-depth").value=e.hyperparameters.networkDepth),this.initNetwork(),e.network&&e.network.activation&&(this.network.activation=e.network.activation),e.network&&e.network.layers){for(let t=0;t<e.network.layers.length;t++)this.network.layers[t].w=e.network.layers[t].w,this.network.layers[t].b=e.network.layers[t].b;this.network.actorHead.w=e.network.actorHead.w,this.network.actorHead.b=e.network.actorHead.b,this.network.criticHead.w=e.network.criticHead.w,this.network.criticHead.b=e.network.criticHead.b}this.visualizer.visualize(this.network),C.success(`Network loaded! ${e.episode} episodes of training restored`),L(`Loaded network trained for ${e.episode} episodes`)}catch(e){C.error("Failed to load network: "+e.message),L("Error loading network: "+e.message)}},i.readAsText(e)},t.click()}exportTrainingData(){let t="Episode,Survival_Steps,Actor_Loss,Critic_Loss,Exploration_Rate\n";for(let n=0;n<this.survivalHistory.length;n++)t+=`${n+1},${this.survivalHistory[n]},${this.lossChart.actorLosses[n]||0},${this.lossChart.criticLosses[n]||0},${this.exploration}\n`;const e=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=`cartpole-training-${(new Date).toISOString().substring(0,10)}.csv`,s.click(),URL.revokeObjectURL(i),C.success(`Training data exported (${this.episode} episodes)`),L(`Exported training data: ${this.episode} episodes`)}applyPreset(t){const e={quick:{lr:.005,discount:.99,entropy:.02,hidden:32,depth:1,speed:8},deep:{lr:.003,discount:.99,entropy:.015,hidden:64,depth:2,speed:1},exploration:{lr:.002,discount:.95,entropy:.05,hidden:32,depth:1,speed:3},production:{lr:.001,discount:.99,entropy:.01,hidden:128,depth:2,speed:1}}[t];if(!e)return void C.error("Unknown preset: "+t);document.getElementById("learning-rate").value=e.lr,document.getElementById("discount").value=e.discount,document.getElementById("entropy-coef").value=e.entropy,document.getElementById("hidden-size").value=e.hidden,document.getElementById("network-depth").value=e.depth,this.trainingSpeed=e.speed,document.getElementById("training-speed").value=e.speed,this.initNetwork(),this.heatmap.clear(),this.lossChart.clear();C.success(`Preset loaded: ${{quick:"âš¡ Quick Train",deep:"ðŸ§  Deep Learn",exploration:"ðŸ” Exploration",production:"ðŸ­ Production"}[t]}`),L(`Applied ${t} preset`)}setupGlobalKeyboardShortcuts(){document.addEventListener("keydown",t=>{if("INPUT"!==document.activeElement.tagName)switch(t.key){case" ":t.preventDefault(),this.toggleTraining();break;case"t":case"T":this.isTraining||this.isManual||this.testPolicy();break;case"r":case"R":this.resetPolicy();break;case"s":case"S":this.isTraining||this.isTesting||this.isManual||this.saveNetwork();break;case"l":case"L":this.isTraining||this.isTesting||this.isManual||this.loadNetwork();break;case"m":case"M":this.isTraining||this.isTesting||this.toggleManual();break;case"p":case"P":this.isTraining&&this.togglePause()}},{passive:!1})}animate(){this.renderer.render(this.env),this.updateStateDisplay(),requestAnimationFrame(()=>this.animate())}};window.sandbox=j,L("CartPole RL Sandbox initialized successfully");
